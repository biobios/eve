# Eve プロジェクト - AIエージェント作業ガイド

> **重要**: このプロジェクトはAIのコーディングのみで開発することを目標としています。

## 📋 プロジェクト概要

**プロジェクト名**: Eve  
**種類**: Electron + TypeScript製デスクトップアプリケーション  
**主な機能**: Google Gemini AI を使用したチャットアシスタント  
**開発言語**: TypeScript  
**フレームワーク**: Electron  
**AI/ML**: LangChain + LangGraph + Google Gemini API  
**データベース**: SQLite（マイグレーション管理システム搭載）
**セキュリティ**: 多層暗号化システム

## 🎯 主要機能

Eveは以下の機能を提供するデスクトップアプリケーションです：
- **Google Gemini AIとのチャット機能**: Gemini 1.5 Flash, 2.0 Flash モデルによる高度な対話
- **複数APIキー管理**: 複数のAPIキーを暗号化保存、切り替え可能
- **高度なセッション管理**: 
  - 複数の会話並行管理、メタデータ付き履歴保存
  - 一覧表示による直感的なセッション選択
  - 右クリックメニューによるセッション削除
  - 選択的な画面リセット（削除対象セッションのみ）
- **会話履歴の永続化**: SQLiteベースの安全なローカル保存
- **企業級セキュリティ**: 多層暗号化によるAPIキー保護
- **初期設定ウィザード**: 初回起動時のガイド付きセットアップ
- **自動データベース管理**: マイグレーション、バックアップ、ヘルスチェック機能
- **モダンサイドバーUI**: ハンバーガーメニューによる左サイドバーナビゲーション
- **ガラスモーフィズムデザイン**: 美しい半透明インターフェース
- **セキュアな通信**: プリロードスクリプトによる安全なIPC通信
- **クロスプラットフォーム対応**: Windows、macOS、Linux対応
- **リアルタイム状態管理**: 接続状態、ローディング状態の表示
- **確認ダイアログ**: 重要操作での安全性確保（自動イベントリスナー設定）
- **動的セッション命名**: 最初のメッセージ内容に基づく自動セッション名生成
- **新しい会話モード**: セッション作成を遅延し、実際のメッセージ送信時に作成
- **レスポンシブ設計**: モバイル・タブレット対応UI

## 🏗️ プロジェクト構造

### ファイル構造
- `src/`: TypeScriptソースコード（総計約2,600行）
  - **コアシステム**: `main.ts`, `database-manager.ts`, `database-migration.ts`
  - **データベース管理**: `database-health-checker.ts`, `database-backup-manager.ts`, `database-logger.ts`
  - **AIシステム**: `ai-manager.ts`, `ai-service.ts`, `conversation-manager.ts` 
  - **セッション管理**: `session-manager.ts`, `session-storage.ts`
  - **セキュリティ**: `crypto-utils/` (リファクタリング済み)
  - **通信**: `ipc-handlers/` (モジュール化), `preload.ts`, `window-manager.ts`
  - **フロントエンド**: `chat.ts` (484行), `ui-managers/` (8ファイル構成)
  - **設定**: `settings-manager.ts`, `database-migrations-config.ts`
- `dist/`: コンパイル後のJavaScript（自動生成）
- `docs/`: ドキュメント
  - `AI_AGENT_GUIDE.md`: AIエージェント作業ガイド（本文書）
  - `ARCHITECTURE_REFERENCE.md`: 詳細アーキテクチャ情報
  - `DEVELOPMENT_WORKFLOW.md`: 開発ワークフロー、デバッグ、トラブルシューティング
  - `REFACTORING_HISTORY.md`: リファクタリング履歴と変更詳細
  - `TECHNICAL_REFERENCE.md`: 技術詳細リファレンス
- ルートディレクトリ: `chat.html`, `initial-setup.html`, 設定ファイル

### 技術スタック概要
```
フロントエンド: HTML + CSS + TypeScript (ESモジュール)
バックエンド: Electron + Node.js + TypeScript (CommonJS)
データベース: SQLite + better-sqlite3
AI: LangChain + LangGraph + Google Gemini API
セキュリティ: Electron safeStorage + crypto-js AES
```

## 📖 基本的な使用方法

### 新しい会話の開始
1. **「新しい会話」ボタンをクリック**
   - サイドバーまたはメインエリアの「新しい会話」ボタンを押す
   - この時点ではまだセッションは作成されない（新しい会話モード開始）
   - 入力フィールドが有効化される

2. **最初のメッセージを送信**
   - メッセージを入力してEnterキーまたは送信ボタンを押す
   - この時点でセッションが自動作成される
   - メッセージ内容を解析して動的にセッション名を生成
   - AI応答が返され、会話が開始される

### セッション管理
1. **セッション一覧の確認**: サイドバーでセッション一覧を確認
2. **セッション切り替え**: サイドバーのセッション項目をクリック
3. **セッション削除**: セッション項目を右クリック → 「削除」を選択

### APIキー管理
1. **APIキー設定**: サイドバーの「APIキー管理」をクリック
2. **Google Gemini APIキーを入力**: 多層暗号化で安全に保存される

### サイドバーナビゲーション
1. **サイドバー開閉**: 画面左上のハンバーガーメニュー（≡）をクリック
2. **機能へのアクセス**: 新しい会話作成、セッション管理、APIキー設定

## 🛠️ 作業時の重要なポイント

### コーディング規約
1. **TypeScript厳格モード**: 型安全性を最優先
2. **Electronセキュリティ**: プリロードスクリプトによるセキュアな通信
3. **非同期処理**: async/await パターンの徹底
4. **エラーハンドリング**: try-catch による適切な例外処理
5. **データベース整合性**: トランザクション使用の徹底
6. **モジュール設計**: 単一責任原則による責任分離
7. **ESモジュール**: フロントエンドでのモダンJavaScript仕様活用

### セキュリティ要件
- **APIキー**: 必ず多層暗号化で保存（Electron safeStorage + crypto-js）
- **contextIsolation**: 有効状態を維持
- **nodeIntegration**: 無効状態を維持
- **プリロードスクリプト**: セキュアAPIのみ公開
- **入力検証**: IPCハンドラーでの厳密な検証とサニタイズ

### データベース開発要件
- **マイグレーション**: 新機能は必ずマイグレーションを通じて実装
- **トランザクション**: データ整合性のため全変更でトランザクション使用
- **バックアップ**: 重要な変更前は自動バックアップ実行

### AI開発要件
- **LangGraph**: 状態管理とワークフローを活用
- **Checkpointer**: SQLiteベースで会話履歴を自動保存
- **エラーハンドリング**: AI API障害に対する適切な復旧処理
- **セッション分離**: セッション間でのデータ混在防止

## ⚠️ 注意事項

1. **APIキー管理**: Google Gemini APIキーはユーザーが設定する仕様、多層暗号化保存対応
2. **データプライバシー**: 会話履歴はローカルSQLiteに保存、外部送信なし
3. **セキュリティ**: プリロードスクリプトによるセキュアAPI、contextIsolation有効
4. **データベース整合性**: マイグレーション機能により自動スキーマ管理、手動変更禁止
5. **クロスプラットフォーム**: パスやファイル操作に注意、Electronビルダー対応
6. **メモリ管理**: Electronの特性を考慮したリソース管理、長時間実行対応
7. **エラーハンドリング**: 各層でのtry-catch、ユーザーフレンドリーなエラーメッセージ
8. **セッション管理**: 複数セッション並行、UUIDベースのID管理
9. **マイグレーション**: up/downマイグレーションの両方向実装必須
10. **暗号化**: APIキーは必ず二重暗号化（ElectronSafeStorage + crypto-js）で保存

## 📚 関連ドキュメント

### 詳細情報が必要な場合の参照先

#### **ARCHITECTURE_REFERENCE.md**
**使用ケース**: アーキテクチャの詳細を理解したい場合
- 詳細なコンポーネント構成
- データフロー図
- 各ファイルの役割詳細
- デザインテーマとUI要素詳細

#### **DEVELOPMENT_WORKFLOW.md**
**使用ケース**: 開発環境のセットアップやデバッグが必要な場合
- 開発環境設定
- TypeScript設定詳細
- ビルド・デバッグ手順
- トラブルシューティング
- デプロイメント手順

#### **REFACTORING_HISTORY.md**
**使用ケース**: リファクタリング履歴や変更詳細を確認したい場合
- 最新のリファクタリング完了事項
- ESモジュール対応詳細
- UI管理システム分離詳細
- 各リファクタリングの技術的改善点

#### **TECHNICAL_REFERENCE.md**
**使用ケース**: 技術詳細や統計情報が必要な場合
- 技術統計情報
- パフォーマンス詳細
- API仕様詳細

#### その他
- [README.md](../README.md): プロジェクトの基本情報と使用方法
- [package.json](../package.json): 依存関係とスクリプト
- [tsconfig.json](../tsconfig.json): TypeScript設定

---

**このドキュメントは、AIエージェントがEveプロジェクトで効率的に作業するためのコアガイドです。詳細な技術情報が必要な場合は、上記の関連ドキュメントを参照してください。**

---
*最終更新: 2025年8月12日*  
*プロジェクトバージョン: 1.0.0*  
*総コード行数: 約2,600行*  
*対応Node.js: v14以上*  
*対応Electron: ^37.2.5*
